---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<html>
<head>
    <title>Tienda de Carros</title>
</head>
<body>
    <Header />
    <div class="container mx-auto px-4 py-16">
        <h1 class="text-xl font-bold text-center">Bienvenido a la Tienda de Carros</h1>
        <p class="text-center mt-4">Explora nuestra amplia gama de carros y encuentra el perfecto para ti.</p>
        <div id="car-list" class="grid grid-cols-3 gap-4"></div>
    </div>
    <Footer />

    <script type="module">
      // Definiciones de funciones dentro del script del cliente
      async function fetchCars() {
        try {
          const response = await fetch('http://localhost:5000/api/cars');
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const cars = await response.json();
          return cars;
        } catch (error) {
          console.error('Failed to fetch cars:', error);
          return [];
        }
      }

      async function deleteCar(carid) {
        try {
          const response = await fetch(`http://localhost:5000/api/cars/${carid}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json',
            },
          });
          if (response.ok) {
            alert('Carro eliminado exitosamente');
            loadCars();
          } else {
            const errorData = await response.json();
            console.error('Error al eliminar el carro:', errorData);
            alert('Error al eliminar el carro: ' + errorData.message);
          }
        } catch (e) {
          console.error('Failed to delete car:', e);
        }
      }

      async function loadCars() {
        const cars = await fetchCars();
        const carList = document.getElementById('car-list');
        if (carList) {
          if (cars.length === 0) {
            carList.innerHTML = '<p>No hay carros disponibles en este momento.</p>';
          } else {
            carList.innerHTML = cars.map((car) => `
              <div class="border p-4 mb-4">
                <h2 class="text-lg font-bold">${car.brand} ${car.model} (${car.year})</h2>
                <p>Propietario: ${car.owner}</p>
                <p>Precio: $${car.price}</p>
                <img src="${car.Image}" alt="Imagen del Carro" class="w-full h-auto"/>
                <button class="bg-red-500 text-white py-2 px-4 mt-4" data-id="${car._id}">
                  Eliminar
                </button>
              </div>
            `).join('');

            // AsignaciÃ³n de eventos a botones
            document.querySelectorAll('#car-list button').forEach(button => {
              button.addEventListener('click', () => deleteCar(button.dataset.id));
            });
          }
        }
      }

      document.addEventListener('DOMContentLoaded', loadCars);
    </script>
</body>
</html>
